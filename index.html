<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Three.js Car Controller</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <!-- Load Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script>
      // Ensure Three.js is loaded before this script runs
      window.onload = function () {
        // Three.js Scene Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Dirt Textured Ground
        const loader = new THREE.TextureLoader();
        const groundTexture = loader.load('https://i.imgur.com/3vAOZrm.jpg'); // Example dirt texture URL
        groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
        groundTexture.repeat.set(20, 20);

        const ground = new THREE.Mesh(
          new THREE.PlaneGeometry(100, 100),
          new THREE.MeshStandardMaterial({ map: groundTexture })
        );
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Lighting
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(10, 10, 10).normalize();
        scene.add(light);

        // Car (using GLTF model)
        let car;
        const gltfLoader = new THREE.GLTFLoader();
        gltfLoader.load(
          'path/to/car_model.gltf',
          (gltf) => {
            car = gltf.scene;
            car.scale.set(0.5, 0.5, 0.5);
            car.position.y = 0.25;
            scene.add(car);
          },
          undefined,
          (error) => {
            console.error('Error loading GLTF model:', error);
          }
        );

        // Camera Position
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        // Movement Variables
        let forward = 0, turn = 0;

        // Keyboard Controls
        document.addEventListener('keydown', (event) => {
          switch (event.code) {
            case 'ArrowUp': forward = 0.1; break;
            case 'ArrowDown': forward = -0.1; break;
            case 'ArrowLeft': turn = 0.05; break;
            case 'ArrowRight': turn = -0.05; break;
          }
        });

        document.addEventListener('keyup', (event) => {
          switch (event.code) {
            case 'ArrowUp':
            case 'ArrowDown': forward = 0; break;
            case 'ArrowLeft':
            case 'ArrowRight': turn = 0; break;
          }
        });

        // Animation Loop
        function animate() {
          requestAnimationFrame(animate);

          // Ensure car is loaded before applying movement logic
          if (car) {
            // Update Car Movement
            car.rotation.y += turn;
            car.position.x += Math.sin(car.rotation.y) * forward;
            car.position.z += Math.cos(car.rotation.y) * forward;

            // Update Camera
            camera.position.x = car.position.x + 5 * Math.sin(car.rotation.y);
            camera.position.z = car.position.z + 5 * Math.cos(car.rotation.y);
            camera.lookAt(car.position);
          }

          renderer.render(scene, camera);
        }

        animate();
      };
    </script>
  </body>
</html>
